\documentclass[12pt,fleqn]{article}\usepackage{../../common}
\begin{document}
Ana-Çift Ýç Nokta Metotlarý (Primal-Dual Interior-Point Methods)

Þimdiye kadar gördüðümüz problem tiplerini hatýrlayalým þimdi ve çözme
zorluðu açýsýndan sýralayalým. En üstte, en basit olan karesel
problemlerdi, 

$$
\min_x \frac{1}{2}  x^T Q x + c^T x
$$

formunda oluyorlardý. Bu problemler en basiti, eðer $Q$ pozitif yarý-kesin
ise. Basit çünkü gradyani alýp sýfýra eþitliyorum, pat diye sonucu
buluyorum. 

Sonraki seviye, biraz daha zor, üstteki probleme $Ax=b$ formunda eþitlik
kýsýtlamasý getirmek. Bu problemi de kapalý / analitik halde (closed-form)
çözebiliriz, KKT koþullarýný kullanarak. $Ax=b$ ifadesini ek deðiþkenler
üzerinden kritere ekleriz, Lagrangian'ý oluþtururuz, KKT koþulunda iki tane
öðe olur, duraðanlýk, ve ana olurluk, bu iki öðeyi eþzamanlý olarak çözerek
sonuca ulaþýrýz, koca bir lineer sistemdir bu. 

Bir sonraki pürüzsüz minimizasyon, yani üstteki kriterin yerine $f(x)$
kullanmak ki $f(x)$ bir pürüzsüz fonksiyon. Bu durumda Newton metotu
kullanýyoruz, bu metot $Ax=b$ kýsýtlamasýnda $f(x)$ minimizasyonunu birkaç
adýmda çözmeye uðraþýyor, bunu her adýmda $f(x)$'e bir karesel yaklaþýklama
yaparak baþarýyor. 

Sonraki seviye ise iç nokta metotlarý, eþitlik kýsýtlamalarýna ek olarak
$h_i(x) \le 0, i=1,..,m$ formunda eþitsizlik kýsýtlamalarý eklemek.  Bu
derste bu tür problemleri ana-çift yöntemi ile çözeceðiz, daha önceki bir
derste bariyer yöntemi iç nokta metotu ile çözdük. 

Genel olarak yaptýðýmýz herhangi bir seviyedeki problemi çözmeye
uðraþtýðýmýzda onu bir önce seviyedeki probleme indirgemek, problemi belli
adýmlara bölerek her adýmda nasýl iþlediðini bildiðimiz önceki seviyedeki
tekniði uygulamak. Bariyer metotunda öyle oldu mesela, eþitsizlik
problemini bariyer terimini kritere ekleyerek bilinen Newton adýmlarýyla
onu çözmeye uðraþtýk. 

Ana-çift metotu biraz daha farklý olacak. Onu öðrendiðimizde göreceksiniz
ki bir problemi açýk bir þekilde baþka bir probleme indirgemediðini
göreceksiniz [1, 5:55]. Bu tekniði sarsýma puðratýlmýþ KKT koþullarý
ýþýðýnda ele almak lazým, ana prensibi bu. 

[bariyer metot ozeti atlandi]

Ana-çift metotu, bariyer metodundan farklý olarak, $t$ parametresinin
güncellemeden önce sadece tek Newton adýmý atar. Yani ana-çift metotunda da
yaklaþýksallamanýn kuvvetini kontrol eden bir $t$ var, ama o belli bir $t$
üzerinden yakýnsama oluncaya kadar Newton adýmý atmak yerine her $t$ için
tek Newton adýmý atýlýyor. Bu demektir ki dýþ döngü, iç döngü farký yok,
her þey tek bir döngü içinde.

Bir diðer fark ana-çift döngüsünde giderken üretilen (ziyaret edilen)
noktalar illa olurlu olmayabiliyor. Yapýsý itibariyle metot döngüsü
sýrasýnda eþitsizlik kýsýtlamalarýný tatmin eder, fakat her zaman eþitlik
kýsýtlamalarýný tatmin etmeyebilir. Hatta bazen ikiz olurlu noktalar bile
mevcut olmayabilir, bu daha ciddi bir durum. Hatýrlarsak bariyer metotunda
ikiz olurlu nokta her zaman vardý ve bu noktayý bir ikiz boþluðu hesaplamak
için kullanabiliyorduk. Bu boþluðu hesaplamak kolaydý, her noktada
$m / t < \epsilon$ deðerindeydi.

O zaman ana-çift ile bu hesap yoksa, ne zaman duracaðýmýzý tam bilmiyoruz
demektir, demek ki akýllýca uydurma (heuristic) yaparak bir durma þartý
bulmamýz lazým.

Pozitif baðlamda ana-çift metotlarý daha verimli çalýþýr. Ýspatýna
girmeyeceðiz ama ana-çift yakýnsamasý lineerden daha iyidir.

Negatif olarak ana-çift metotlarýný kabaca, sezgisel kavramak bariyer
metotu kadar direk olmayabilir. Þahsen bu alanda araþtýrmacý olan ben bile
ana-çift metot adýmlarýnýn temelii hatýrlamakta bazen zorlanýyorum, bariyer
metotunu hatýrlamak basit, kýsýtlamanýn log'unu alýp kritere ekliyorsunuz,
sonra Newton metotu uyguluyorsunuz [13:35].

Detaylara gelelim. KKT koþul sarsýmýný hatýrlarsak, bariyer metotunu KKT
koþullarýnda bir sarsým olarak görebiliyorduk, þu ifadelerde

$$
\nabla f(x) + \sum_{i=1}^{m} u_i\nabla h_i + A^T v = 0
\mlabel{1}
$$

$$
u_i \cdot h_i(x) = (-1/t) 1, \quad i=1,..,m
$$

$$
h_i(x) \le 0, \quad i=1,..,m, \quad Ax = b
$$

$$
u_i \ge 0
$$

Normal sartlarda bloktaki ikinci ifade yerine 

$$
u_i \cdot h_i(x) = 0, \quad i=1,..,m
\mlabel{2}
$$

olacaktý. Deðiþen tamamlayýcý gevþeklik yani.

Ana problem neydi?

$$
\min_x f(x) \quad \textrm{öyle ki}
$$
$$
Ax = b
$$
$$
h_i(x) \le 0, \quad i=1,..,m
$$

Bu problemin KKT þartlarý görülen blokta, duraðanlýk için gradyan alýp
sýfýra eþitlenir, (1) elde edilir, tabii $f,h_i$'in pürüzsüz ve dýþbükey
olduðu farz edilir, o sebeple gradyan yeterli, altgradyana gerek yok, vs.
Tek deðiþtirdiðimiz tamamlayýcý gevþeklik ve onun artýk sýfýra eþit
olmasýný þart koþmuyorum, ufak baþka bir deðere, ve doðru iþarete sahip
olan baþka bir deðere eþit olmasýný zorluyorum, $u_i \cdot h_i(x) = (-1/t)$
þartý bu. $1/t$ gibi bir deðerin sebebi aslýnda $\log(x)$'in türevinin
$1/\log(x)$ olmasýyla alakalý, çünkü log bariyerleþtirilmiþ kriterin
türevini alýp sýfýra eþitleyince ve ikiz deðiþkenleri uygun þekilde
tanýmlayýnca log bariyer metotunun orijinal KKT koþullarý yerine üstteki
þekilde bir problemi çözülebildiðini görmüþtük [1, 16:19], ve $t$
büyütüldükçe görülen deðiþtirilmiþ tamamlayýcý gevþeklik esas versiyonuna
daha da yaklaþýyordu.

Ana-çift metotlarýna eriþmenin bir diðer yolu sarsýmýn ortaya çýkarttýðý
denklemleri birarada çözmek ve Newton adýmýný ona göre atmak [1, 22:55]. 

Denklemler ayrý ayrý olarak 

$$
r_{dual}= \nabla f(x) + Dh(x)^T u + A^T v 
\mlabel{6}
$$

$$
r_{cent} = -\diag(u)h(x) - 1/t 
$$

$$
r_{prim} = Ax - b
$$

Sarsým denklem sistemini sýfýra eþitlemek amacýyla matris formunda
düzenlersek, 

$$
r(x,u,v) = 
\left[\begin{array}{c}
\nabla f(x) + Dh(x)^T u + A^T v \\
-\diag(u)h(x) - 1/t \\
Ax - b
\end{array}\right]
\mlabel{3}
$$

ki

$$
h(x) = \left[\begin{array}{c}
h_1(x) \\
\dots \\
h_m(x)
\end{array}\right]
\quad
D h(x) = \left[\begin{array}{c}
D h_1(x)^T \\
\dots \\
D h_m(x)^T
\end{array}\right]
\mlabel{4}
$$

$r(x,u,v)$'yu sýfýra eþitliyoruz, yani bir anlamda 

$$
0 = r (x+\Delta x, u + \Delta u, v + \Delta v)
$$

çözülecek, bunu 1. derece Taylor açýlýmý ile yaklaþýklarým,

$$
\approx r(x,u,v) + D r(x,u,v) \left[\begin{array}{c}
\Delta x \\ \Delta u \\ \Delta v
\end{array}\right]
$$

Üstteki denklemde (3) ve (4) öðelerini kullanarak özyineli þekilde dönersem
gayrý-lineer denklemi çözmüþ olurum. Notasyonu biraz degistirirsek,
$y = (x,u,v)$ ile,

$$
0 = r(y + \Delta y) \approx r(y) + D r(y) \Delta y
$$

ve $\Delta y$ için çözmek istiyoruz. 

Ya da, genel bir $F$ için $F(y) = 0$ çözümü, yani ``kök bulmak'' amacýyla
her döngü adýmýnda bir $\Delta y$ hesaplayabilmek istiyoruz. Þu þekilde

$$
F(y + \Delta y) \approx F(y) + D F(y) \Delta y
$$

yaklaþýklarsak, ve kök amaçlý $F(y)=0$ olmalý ama $F(y + \Delta y) = 0$ da
denebilir,

$$
0 \approx F(y) + D F(y) \Delta y
$$

$$
-F(y) =  D F(y) \Delta y
$$

$$
\Delta y = -(DF(y))^{-1} F(y) 
$$

Ya da

$$
DF(y) \Delta y = -F(y) 
$$

Bu problemde $F$ yerine $r$ var. 

$$
D r(y) \Delta y = -r(y) 
$$

O zaman (3)'teki $r(y)$'nin türevi, yani Jacobian'ý gerekiyor. Üsttekini
þöyle yazýyoruz, 

$$
\left[\begin{array}{ccc}
\nabla^2 f(x) + \sum _{i=1}^{m} u_i \nabla^2 h_i(x) & D h(x)^T & A^T \\
-\diag(u) D h(x) & -\diag(h(x)) & 0 \\
A & 0 & 0
\end{array}\right]
\left[\begin{array}{c}
\Delta x \\ \Delta y \\ \Delta v
\end{array}\right] = 
\left[\begin{array}{c}
r_{dual} \\ r_{cent} \\ r_{prim}
\end{array}\right]  
\mlabel{5}
$$

Büyük Jacobian'ý nasýl elde ettik? Mesela (3)'ün ilk satýrýna bakalým, 

$$
\nabla f(x) + Dh(x)^T u + A^T v 
$$

var, onun $x,u,v$'ye göre türevlerini almak bize iki üstteki matrisin
1. satýr 1. 2. ve 3. kolonunu veriyor, mesela $x$'e göre türev alýnca bir
üstteki ifadede 1. ve 2. terimin türevi alýnýr, $A^T v $ yokolur, bu bize
$\nabla^2 f(x) + \sum _{i=1}^{m} u_i \nabla^2 h_i(x)$ verir [1, 28:43].
Ayný þekilde devam edersek görülen matrisi elde ederiz. Tüm sistemi
$\Delta y$ için çözünce de istediðimiz Newton yönünü elde ederiz.

Bu yönteme ana-çift denmesinin sebebi üstte görülüyor aslýnda, çünkü dikkat
edersek hem ana hem ikiz deðiþkenleri ayný sistemde, ayný anda
çözüyoruz. Deðil mi? Denklem sistemi KKT koþularýnýn formülize edilmesinden
geldi, ve bu koþullara ana ve ikiz deðiþkenler ayný yerde mevcuttur, ve
çözerken tüm $x,u,v$ için çözüyoruz. 

Not: Bu yaklaþýmla bariyer metotuna eriþmek mümkün, o durumda sistemden $u$
çýkartýlýr, ve geri kalanlar çözülür. 

Metotu algoritmik olarak görmeden önce bir konudan daha bahsetmek
istiyorum; alternatif ikizlik boþluðu. Bu gerçek ikizlik boþluðu deðil,
çünkü daha önce belirttiðimiz gibi bu metotta ikiz deðiþkenler her zaman
olurlu olmayabiliyor.

Bariyer metotu için ikizlik boþluðu basitti, $m/t$ çünkü
$u_i = -1 / (t h_i(x))$, $i=1,..,m$ tanýmlamýþtýk ve bu ikiz olurlu idi.
Alternatif boþluk için sanki ikiz olurluk varmýþ gibi yapýyoruz, ve 

$$
\eta = -h(x)^T u = - \sum _{i=1}^{m} u_i h_i(x)
$$

hesabýný yapýyoruz. Eðer üstteki hesabý bariyer problemi için yapýyor
olsaydýk, $u_i = -1/t$ tanýmlamýþ olacaktýk ve o zaman bariyer metotu için
olan boþluðu elde edecektik. Ana-çift yönteminde böyle deðil tabii, sistemi
çözerken $u_i$ için de çözüm yapýyoruz, onu önceden tanýmlamýyoruz, fakat
üstteki formu kullanarak alternatif ikizlik boþluðunu elde edebiliriz.  
$\eta$ her zaman pozitif olacak, çünkü kendimizi her zaman $h_i(x) \le 0$
olacak þekilde kýsýtlayacaðýz, ve $u_i \ge 0$ zaten, o zaman çarpýmlarýnýn
ekþi ile çarpýlmasý pozitif sonuç verir.

Tüm bunlarý durma þartý için nasýl kullanýrýz? Her ne kadar $u_i$'lar
olurlu olmayabilse bile yine de boþluðu hesaplýyoruz, ardýndan ikiz
deðiþkenlerin olurluða ne kadar yakýn olduðunu ayrý bir yerde
hesaplýyoruz. Yani eðer alternatif boþluk az, ve olurluða yakýnlýk varsa,
akýllýca bir uydurma ile kullanarak durma / durmama kararý verebiliriz.
Gerçi bu teknik uydurmadan biraz daha iyi aslýnda, ana-çift metotunun
yakýnsadýðýna dair matematiksel ispatlar var, fakat terminolojik olarak bu
boþluk hesabý gerçek bir boþluk hesabý deðil.

Artýk metotu tanýmlayabiliriz. Bir harfiyen olurlu $x^{(0)}$ ile baþla,
yani bu nokta $h_i(x^{(0)}) < 0 $, ve $A x^{(0)}= b$. Ayrýca $u^{(0)} > 0$,
$v^{(0)}$ herhangi bir deðer. Alternatif ikizlik boþluðu
$\eta^{(0)} = -h(x^{(0)})^T u^{(0)}$ olarak tanýmla [1, 45:21].

$t$'yi büyütmek için $\mu > 1$ kullanýyoruz. Her döngü sonunda eski $t$'yi
$\mu$ ile çarpýp yeni $t$ elde edeceðiz.  

Adýmlar

1) $t = \mu m / \eta^{(k-1)}$ tanýmla. 

2) Ana-çift güncelleme yönü $\Delta y$'yi hesapla (nasýl yapýlacaðýný
gördük, (5)'teki lineer sistemi çözerek).

3) Geri iz sürme (backtracking) tekniði ile adým büyüklüðü $s$'yi hesapla
(birazdan nasýl yapýlacaðýný göreceðiz)

4) $y^{(k)} = y^{(k-1)} + s \cdot \Delta y$ ile $y$'yi güncelle. Yani bu
hesapla tüm ana, ikiz deðiþkenleri güncellemiþ oluyoruz, $x,u,v$. 

5) Alternatif ikizlik boþluðunu hesapla $\eta^{(k)} = -h(x^{(k)})^T
u^{(k)}$. 

6) Ana ve ikiz artýklar ufak ise, yani eðer $\eta^{(k)} < \epsilon$ ise ve 
$(|| r_{prim} ||_2^2 + ||r_{dual}||_2^2)^{1/2} < \epsilon$ ise dur. 

$r_{prim}$ hatýrlarsak eþitlik sýnýrlamasýndan ne kadar uzak
olduðumüz. $r_{dual}$ ise duraðanlýk þartýydý, onun sýfýrdan ne kadar uzak
olduðuydu. Niye ona ``ikiz (dual)'' etiketi verdik? Bunun ikiz olurluk ile
ne alakasý var? Burada biraz nüans var.. 

Not: artýk kelimesini kullandýk daha önce  $r_{dual}$ ikiz artýk,
$r_{prim}$ ana artýk. 

Hatýrlarsak $u,v$ üzerindeki kýsýtlamalar nelerdi? $u \ge 0$, ve $v$
herhangi bir þey olabilir. Ama dolaylý bir kýsýtlama daha var aslýnda, o da
$u,v$'nin Lagrange iki fonksiyonunun taným alanýnda olma zorunluluðu.. Ve
bu kýsýtlamalar iþte (6)'dan baþlayan üç denklemde aslýnda belirtiliyor. 
Yani, çünkü eðer alttaki sýfýr ise

$$
\nabla f(x) + D h(x)^T u + A^T v = 0
$$

bu sadece ve sadece doðru olabilir $x$ eðer $x$ üzerinden $L(x,u,v)$'i
minimize ediyorsa. Ki bu durumda 

$$
g(u,v) = L(x,u,v)
$$

doðru olur. Yani $x$ Lagrangian'i minimize ediyorsa, taným itibariyle
$L(x,u,v)$ ekþi sonsuzluk deðildir. Deðil mi? Çünkü eksi sonsuzluða gidiþ
olmasýn diye ikizde spesifik kýsýtlamalar getirdik. Ve bu da demektir ki
$u,v$ Lagrangian'in taným alanýnda olmalý.

Geri Ýz Sürme

Üstteki algoritmada \#4 adýmýnda bir adým atýldýðýný gördük, fakat bu adým
atýlýrken $s$'nin nasýl bulunacaðýný anlatmadýk. Adým atýlýrken
$y^+ = y + s \Delta y$ ile, $h_i(x) \le 0$, ve $u_i(x) > 0$ þartlarýnýn
hala geçerli olmasýný garantilemek istiyoruz, ve $s$'yi bu olacak þekilde
seçeceðiz. Tabii $y^+ = y + s \Delta y$ derken

$$
x^+ = x + s \Delta y
$$

$$
u^+ = u + s \Delta y
$$

$$
v^+ = v + s \Delta y
$$

demek istiyoruz. Bu seçim þöyle yapýlabilir, önce $s$'yi her öge için
$u_i > 0, i=1,..,m$ olacak sekide mümkün en büyük adýmdan baþlarýz. Bu
çözüm kolaydýr, çünkü her $u_i$ için her $\Delta u_i$ bizi sýfýra
yaklaþtýrýyor mu, eðer yaklaþtýrýyorsa sýfýra gelmeden ne kadar uzaða
gidebiliriz sorusunuz sorabiliriz, ve tüm bu uzaklýklar arasýndan en ufak
olaný $s$ seçimi için baþlayacaðýmýz en büyük uzaklýk olacaktýr. Tabii
harfiyen olurluk istiyoruz, yani $u > 0$ o zaman bulunan büyüklüðün 0.999'ü
kadarýný alýrýz. 

Bu deðeri alýnca oradan ``geriye iz sürmeye'' baþlarýz, yani küçülte
küçülte bu sefer $h$ þartlarýný da tatmin eden bir $s$ aramaya
baþlayabiliriz. Bu aramayý yaparken $u$ þartýný tatmin edeceðimizden
eminizdir çünkü en büyük $s$'yi özellikle $u$ için ayarladýk.







\inputminted[fontsize=\footnotesize]{python}{primdual.py}

[devam edecek]

Kaynaklar

[1] Tibshirani, {\em Convex Optimization, Lecture Video 16 (Part 1)}, 
\url{https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg}   

[2] Tibshirani, {\em Convex Optimization, Lecture Video 16 (Part 2)}, 
\url{https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg}   

\end{document}



