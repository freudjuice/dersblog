<h1>Log-Bariyer Yöntemi</h1>
<!DOCTYPE html>
<html>
  <head>
    <title>Log-Bariyer Yöntemi
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
<script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
</script>
</head>

<p>[Newton yöntemi özeti atlandı]</p>
<p>Şimdiye kadar kısıtlanmamış Newton yönteminden bahsettik [1, 53:18]. Şimdi
lineer olarak kısıtlanmış, $Ax=b$ ile, olan duruma bakalım, çünkü ileride
faydalı olacak.</p>
<p>En bariz yaklaşım $Ax=b$'nin bir doğrusal (affine) uzay yaratması, ve
optimizasyonun bu daha ufak uzayda iş yapması. Bir değişken değişimi
yaparız, $x = Fy + x_0$, ki $F$, $A$'nin sıfır uzayını kapsıyor, ardından
optimizasyon problemini $y$ bazlı bir probleme indirge. Bu yaklaşıma
"indirgenmiş uzay yaklaşımı" deniyor. Tarif edilen gayet doğal, basit bir
yaklaşım aslında, fakat bir bedeli de var. Eğer orijinal problem seyrek ise
değişim sonrası çok miktarda yapı kaybı (yaı seyreklik) olacak.</p>
<p>Bir diğer seçenek eşitlikle kısıtlanmış Newton (equality constrained
Newton). Bu yöntemle $x^+ = x + t v$ adımında $v$ karesel
yaklaşıksallamanın çözümü, fakat bu çözüm sınırlanmış bir problemin çözümü,
bir sonraki $x^+$'yi olurlu halde tutacak bir sınırlama bu.</p>
<p>Çözülen problem </p>
<p>$$
v = \arg\min_{Az = 0} \nabla f(x)^T (z-x) + \frac{1}{2} (z-x)^T \nabla^2 f(x)(z-x)
$$</p>
<p>Üstteki $x^+$'i olurlu kümede tutar çünkü </p>
<p>$$
Ax^+ = Ax + tAv = b + 0 = b
$$</p>
<p>KKT koşulları üzerinden çözüm</p>
<p>$$
\left[\begin{array}{cc}
\nabla^2 f(x) &amp; A^T \\
A &amp; 0
\end{array}\right]
\left[\begin{array}{c}
v \\
w
\end{array}\right] = 
- 
\left[\begin{array}{c}
\nabla f(x) \\
Ax - b
\end{array}\right]
$$</p>
<p>ile belirtilebilir. KKT bölümünde karesel problem örneğindeki gördüğümüz
$Q$ burada $\nabla^2 f(x)$ oluyor, atılan adım sonrası gelinen yerin ne
olacağı da kısıtlama içinde görülebilir.</p>
<p>Olurlu noktadan basliyorsak, ozel durum $Ax = b$, tabii o zaman </p>
<p>$$
\left[\begin{array}{cc}
\nabla^2 f(x) &amp; A^T \\
A &amp; 0
\end{array}\right]
\left[\begin{array}{c}
v \\
w
\end{array}\right] = 
- 
\left[\begin{array}{c}
\nabla f(x) \\
0
\end{array}\right]
$$</p>
<p>O zaman bariyer metotu nedir? Bu metotla yine Newton metotunu uzatacağız,
ve eşitsizlik olan problemlerle uğraşacağız. </p>
<p>$$
\min_x f(x) \quad \textrm{öyle ki}
$$
$$
Ax = b
$$
$$
h_i(x) \le 0, \quad i=1,..,m
\qquad (3)
$$</p>
<p>Kriter dışbükey, sınırlamalar lineer, ve dışbükey eşitsizlik
sınırlamaları, $h_i(x) \le 0$ ile.</p>
<p>Bariyer metotu eşitsizliklerle başetmenin bir yolu. Eşitsizlik içeren
programların en büyük problemi sınırlarda ne yapılacağına karar vermek,
yani olurlu kümenin sınırlarında. Başetmek için olurlu küme 
$C \equiv { x: h_i(x) \le 0 , i=1,..,m}$ </p>
<p>$$
\min_x f(x) + I_C(x)
$$
$$
Ax = b
$$</p>
<p>ile kritere dahil edilir, ki $I_C$ göstergeç fonksiyonudur. Ana fikir sınır
noktalarında işler zorlaşıyorsa niye oralardan uzak durmuyoruz? Fakat
göstergeç fonksiyonu ile çalışmak zor, onu da yaklaşıksal olarak temsil
ederiz, işte bariyer fonksiyonu budur. Öyle bir fonksiyon seçeriz ki
sınırlarda aşırı büyük değerler vererek bizi minimizasyon bağlamında
oralardan "geri iter". Sanki sınırlara bir manyetik alan koyuyoruz,
oralara yaklaşınca geri itiliyoruz. </p>
<p>Tabii bir yandan Newton metotu da kullanabilmek istiyoruz, ideal olarak
pürüzsüz bir metot olursa elimizde iyi olur. Log bariyer fonksiyonu böyle
bir fonksiyon</p>
<p>$$
\phi(x) = -\sum_{i=1}^{m} \log(-h_i(x))
\qquad (1)
$$</p>
<p>Böylece ana problemi şu hale getirebiliriz,</p>
<p>$$
\min_x f(x) + \frac{1}{t} \phi(x) \quad \textrm{öyle ki}
$$
$$
Ax = b
$$</p>
<p>ki $t&gt;0$. Görülen $1/t$ dışarıdan bizim tanımladığımız bir parametre,
optimizasyonu ayarlamak için kullanıyoruz onu. Eğer $t$ küçükse, sıfıra
yakınsa o zaman bariyer baskın haldedir (daha büyüktür), tabii o zaman
sınırlardan kaçmak optimizasyon için daha önemli hale gelir. Eğer $t$'yi
büyütürsek bu "orijinal kriter $f$'ye daha fazla önem ver" demektir.</p>
<p>Dersin geri kalanında üstteki format yerine alttaki ile çalışacağız,
üstteki ile aynı, </p>
<p>$$
\min_x t f(x) + \phi(x) \quad \textrm{öyle ki}
$$
$$
Ax = b
\qquad (2)
$$</p>
<p>Log-Bariyer Calculus</p>
<p>(1) için türev</p>
<p>$$
\nabla \phi(x) = - \sum_{i=1}^{m} \frac{1}{h_i(x)} \nabla h_i(x)
$$</p>
<p>Hessian</p>
<p>$$
\nabla^2 \phi(x) = 
\sum _{i=1}^{m} \nabla h_i(x) \nabla h_i(x)^T - 
\sum _{i=1}^{m} \frac{1}{h_i(x)} \nabla^2 h_i(x)
$$</p>
<p>Örnek</p>
<p>Pek çok yerde kullanılan bir eşitsizlik görelim, mesela bütün $x_i &lt; 0$
olduğu bir durum, yani $h_i(x) = -x$. O zaman bariyer neye benzer? </p>
<p>$$
\phi(x) = - \sum _{i=1}^{n} \log x_i
$$</p>
<p>$$
\nabla \phi(x) = 
- \left[\begin{array}{c}
1/x_1  \\ 
\vdots \\
1/x_n
\end{array}\right] 
= - X^{-1} \textbf{1} 
$$</p>
<p>Burada $X$ matrisi </p>
<p>$$
X = \mathrm{diag}(x) = 
\left[\begin{array}{ccc}
x_1 &amp; &amp; \\
    &amp; \ddots &amp; \\
    &amp; &amp; x_n
\end{array}\right]
$$</p>
<p>ve $\textbf{1}$ sembolu tamamen 1'lerden oluşan matris. </p>
<p>Hessian</p>
<p>$$
\nabla^2 \phi (x) = \left[\begin{array}{ccc}
1/x_1^2 &amp; &amp; \\
    &amp; \ddots &amp; \\
    &amp; &amp; 1/x_n^2
\end{array}\right] = X^2 
$$</p>
<p>Problemi yaklaşık olarak temsil ettik. Uygun şartlarda problem (2)'nin
çözümü vardır. Neden olduğunu görmek zor değil, $\phi$ beni sınırlardan
uzak tutar, ve hedefim $f$'ye ulaşırım, lineer diğer sınırları dikkate
alarak tabii. Gidis yolu neye benzerdi?</p>
<p>Merkezi gidiş yolu, (1) için KKT koşulları üzerinden gösterilebilir?  Bu
yol (1) probleminin $t$ üzerinden fonksiyon haline getirilmiş
çözümüdür. Her $t$ için (1)'i çözebilirim, çözüme $x^*(t)$ derim, ve
$x^*$'ye $t$'nin bir fonksiyonu olarak bakınca, bariyer metot çerçevesinde,
ortaya çıkan çözüm serisine merkezi gidiş yolu denir. Her $t$ için (1)'in
çözümünü KKT koşulları üzerinden temsil edebilirim, böylece her adımda
$x^*(t)$'nin optimal olması için ne gerekir sorusunu formülize etmiş
oluyorum.  Önce KKT ana olurluk şartları</p>
<p>$$
A x^* = b, \quad h_i(x^*(t)) \le 0
$$</p>
<p>Geri kalanlar, önce Lagrangian</p>
<p>$$
t f(x) + \phi(x) + w^T (Ax - b)
$$</p>
<p>Bu Lagrangian'in $x$ üzerinden gradyanını alıp sıfıra eşitlersem durağanlık
şartını elde ediyorum. </p>
<p>$$
t \nabla f(x^*(t)) - \sum_{i=1}^{m} \frac{1}{h_i(x^* (t))} 
\nabla h_i(x^*(t)) + A^T w = 0
$$</p>
<p>Durağanlık için gradyan kullanmak yeterli çünkü tüm fonksiyonlar dışbükey
ve pürüzsüz.</p>
<p>Üstteki problemi bazı herhangi bir $w$ için çözebilirsem o zaman merkezi
gidiş yolundaki bir çözümü her $t$ için karakterize etmiş olurum. Umudumuz
o ki $t$'yi sonsuzluğa doğru iterken gördüğümüz KKT koşullarının ima ettiği
çözümler orijinal problemdeki sonuçlara yaklaşsın. Çünkü bariyer
fonksiyonunu $1/t$ ile çarptım ve $t$'yi büyüttükçe çarpım gösterge
fonksiyonuna yaklaştığını biliyorum, o zaman optimizasyonu yaparken $t$'yi
büyüttükçe orijinal problemin gerçek sonucuna yaklaşmış olurum.</p>
<p>Şimdi bir lineer program üzerinden merkezi gidiş yoluna bakalım. Basit bir
LP, eşitlik şartlarını attım, </p>
<p>$$
\min_x c^T x, \quad \textrm{öyle ki}
$$
$$
Dx \le e
$$</p>
<p>Bariyer olarak</p>
<p>$$
\min_x t c^T x - \sum _{i=1}^{m} \log(e_i - d_i^T x)
$$</p>
<p>Bu problemi belli bir $t$ için çözersem, sonra $t$'yi büyütürsem ve o yeni
$t$ için çözersem, bunu ardı ardına yaparsam, umudum o ki orijinal LP'imin
sonucuna yaklaşacağım.</p>
<p><img alt="" src="func_59_barr_01.png" /></p>
<p>Resimde görüldüğü gibi, ortadan başlıyoruz, $t=0$'da diyelim, ve $t$'yi
büyüttükçe yolda ilerliyoruz, ve sonuca erişiyoruz. Gidiş pürüzsüz, ve
LP'lerin karakterinden biliyoruz ki nihai sonuç çokyüzlümün (polyhedra)
ekstrem noktalarının birinde olmalı. Yarı yolda $t=10$'daki bir nokta
egösteriliyor, nihai sonuç belki $t=100$'da [1, 26:59]</p>
<p>KKT koşulu üzerinden durağanlığı temiz bir şekilde gösterebiliyoruz, ya da
iç nokta ve ortada, merkezde bir yol takip edilmesini zorlama bağlamında,
merkezlik şartı da deniyor buna, gradyan alınınca</p>
<p>$$
= tc - \sum _{i=1}^{m} \frac{1}{e_i - d_t ^T x^(t)} d_i
$$</p>
<p>Bu demektir ki gradyan $\nabla (x<em>(t))$ $-c$'ye paralel olmalıdır, ya da
${ x: c^T x = c^T x</em>(t)}$ hiper düzlemi $\phi$'nin $x*(t)$'deki konturuna
teğet durmalıdır. </p>
<p>Birazdan merkezi yoldan ikiz noktalar alabileceğimizi göreceğiz. Bu çok
faydalı olacak çünkü bu ikiz noktaları bir ikiz boşluğu hesaplamak için
kullanacağız. </p>
<p>Merkezi yoldayken bu yoldaki noktalar $x*(t)$'leri kullanarak  ölürlü  ikiz
noktalar hesaplayabiliriz. Orijinal problem (3)'e tekrar bakarsak, bu
problem için ikiz değişkenleri elde etmek için her eşitsizlik için
bir $u_i$'ye, her eşitlik şartı için bir $v_i$'ya ihtiyacım var. Onları
nasıl tanımlarım? Merkezi yol üzerindeki çözümler üzerinden,</p>
<p>$$
u_i^*(t) = \frac{1}{t h_i(x^*(t))}, \quad i=1,..,m, \quad v^*(t) = w/t
$$</p>
<p>$w$ bariyer problemi için KKT koşullarını çözerken elde ettiğim değişken
idi. </p>
<p>Niye üsttekiler orijinal problem için olurlu? Bunu görmek kolay, ilk önce,
$u_i^*(t)$'nin her ögesi harfiyen pozitif, çünkü $h_i(x^*(t))$'nin her
ögesi harfiyen negatif. Bu bariyer probleminin ana olurluk şartından
geliyor. Ayrıca $(u^*(t),v^*(t))$ Lagrange ikiz fonksiyonu $g(u,v)$'nin
tanım kümesinde (domain). Hatırlarsak Lagrange ikizi formülize ettiğimizde
tanım kümesinde bazı dolaylı sınırlamalar elde ediyorduk. Tarif itibariyle</p>
<p>$$
\nabla f(x^*(t)) + \sum _{i=1}^{m} u_i (x^*(t)) \nabla h_i(x^*(t)) + 
A^T v^*(t) = 0
$$</p>
<p>Yani $x^*(t)$, Lagrangian $L(x,u^*(t),v^*(t))$'i tüm $x$'ler üzerinden
minimize edeceği için $g(u^*(t),v^*(t)) &gt; -\infty$. Bu direk durağanlık
şartından geliyor işte. O kadar bariz birşey ki aslında bazen kafa
karıştırıyor. Merkezi yol probleminden çözdüğümüz durağanlık koşulu
şöyleydi,</p>
<p>$$
t \nabla f(x^*(t)) - \sum \frac{1}{h_i(x^*(t))} \nabla h_i(x^*(t)) + A^T w= 0
$$</p>
<p>Bir $x^*$ çözümü ve $w$ olduğunu farz ediyoruz. Tüm formülü $t$ ile
bölersem,</p>
<p>$$
\nabla f(x^*(t)) - \sum \frac{1}{t h_i(x^*(t))} \nabla h_i(x^*(t)) + A^T \frac{w}{t}= 0
$$</p>
<p>Tek yaptımız "üstteki orijinal problemdeki durağanlık şartına çok
benziyor" demek, değil mi, çünkü </p>
<p>$$
\nabla f(x^*(t)) +
\sum \underbrace{\frac{-1}{t h_i(x^*(t))}}_{u_i} \nabla h_i(x^*(t)) + 
A^T \underbrace{\frac{w}{t}}_{v}= 0
$$</p>
<p>desem, orijinal problemin durağanlık şartına benzeyen bir ifade elde etmiş
olurum. </p>
<p>[devam edecek]</p>
<p>Kaynaklar</p>
<p>[1] Tibshirani, <em>Convex Optimization, Lecture Video 14</em>, 
<a href="https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg">https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg</a>   </p>
<p>[2] Tibshirani, <em>Convex Optimization, Lecture Video 15</em>, 
<a href="https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg">https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg</a>   </p>