<h1>Ağ Akış Problemleri (Network flow problems)</h1>
<!DOCTYPE html>
<html>
  <head>
    <title>Ağ Akış Problemleri (Network flow problems)
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
<script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
</script>
</head>

<p>Daha önce işlediğimiz bu konuyu biraz daha genişletelim [1]. Sailco adlı
hayali bir şirket düşünelim, bu şirket yelkenli tekne (sailbot)
üretiyor. Problem şöyle, önümüzdeki 4 ay içinde alttaki üretim sayısını
gerçekleştirmesi gerekiyor (müşteri talebi)</p>
<p>$$ 
\begin{array}{|c|c|c|c|c|}
\hline
\textrm{Ay} &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\
\hline
\textrm{Üretilen tekne sayısı} &amp; 40 &amp; 60 &amp; 70 &amp; 25 \\
\hline
\end{array}
$$</p>
<p>Birinci ayda 40, ikinci ayda 60, vs.. Şirketin bir deposu da var, bitmiş
teknelerin teslim etmeden önce tutuldukları yer burası. 1. ayın başında bu
depoda 10 tane tekne var. Her ay kaç tane tekne (ve nasıl) üretileceğini
hesaplamam lazım, burada işçi turu ve depoda olanlar sayıyı etkiler tabii,
mesela bir ayda 10 tane üretmem gerekiyorsa ve depoda zaten 10 tane varsa,
hiç üretim yapmama gerek yok. Ama gelecekte çok fazla üretmem gerektiğini
biliyorsam ekstra yapıp onları depoda tutabilirim, ki sonra gönderebileyim.</p>
<p>İşçi kısıtlaması şöyle, normal işçiyle 400 lira / tekne üzerinden fazla
mesai ile 450 lira / tekne üzerinden üretim yapabilirim. Tek bir tekneyi
depoda tutmak 20 lira. Ayrıca normal işçi ile ayda sadece 40 tekne
yapabiliyorum, eğer o ayda daha fazla tekne yapmam gerekiyorsa fazla mesai
kullanmam şart.</p>
<p>Problem şöyle, öyle bir üretim ve depolama takvimi planla ki önümüzdeki 4
aydaki üretimi minimum masrafla yapabileyim. </p>
<p>Karar değişkenleri neler olacak? Görüyorum ki bu tür problemlerle uğraşan
bazı öğrenciler genelde az sayıda değişken kullanmaya meyilli, mesela "X
ayında üretilecek tekne sayısı" gibi, ve beklenti o ki formüller işin
gerisini halletsin. Yani mesela ilk ay bariz zaten, depoda 10 tane tekne
var, geri kalanını ilk ayda normal işçilere yaptırırım çünkü bu en ucuzu. O
zaman o ayda üretilen tekne sayısı değişkeni yeter, vs. Fakat göreceğiz ki
bu tür yaklaşımlar aslında işi daha zorlaştırıyor. Aslında işimize
yaramayabilecek ekstra değişkenler tanımlamak, sonra o değişkenleri
kısıtlayıp probleme uygun şekilde dahil etmek daha kolay.</p>
<p>Biz de böyle yapacağız. Bir sürü değişken; mesela X ayı için kaç tane
"normal işçi teknesi" üretilmesi gerektiği, yani bu sayı sadece normal
işçiler tarafından üretilecek tekneleri kontrol edecek, fazla mesai için
farklı olacak.. Her ay depoda kaç tekne tutulduğu ayrı sayılacak, her şey
bir değişken olacak. Belki bu değişkenlerden bazıları fuzuli, hatta başka
bir şeyi tekrar ediyor sanki, başka değişkenlerden türetilebilir gibi
geliyor, olsun, yine de ekstra değişkeni koyun, ama diğer yandan
aklınızdaki o kuralı probleme sınırlama olarak dahil edin. </p>
<p>Yani literaturde bu degiskenlere karar degiskenleri deniyor ama aslinda
onlarin direk karar verdigimiz seyler olmasina gerek yok. </p>
<p>Degiskenler soyle,</p>
<p>$x_1,x_2,x_3,x_4$: her ayda normal iscilik ile uretilen tekne sayisi</p>
<p>$y_1,y_2,y_3,y_4$: her ayda fazla mesai ile uretilen tekne sayisi</p>
<p>$h_1,h_2,h_3,h_4,h_5$: her ay başında depoda olan tekne sayısı. 5 ay var
çünkü ay sonundaki sayıyı $h_5$ değişkeninde tutuyoruz. Tabii problemi iyi
anlayanlarımız farketmiştir ki bu değişkende sıfır değeri olmalı, tüm
tekneler gönderilmiş olmalı.</p>
<p>Parametreler</p>
<p>Bunlar değişken değil dikkat, dışarıdan tanımlanan parametreler. Başta
gördüğümü sayılar bunlar, her ay müşteriden gelen talep, </p>
<p>$d_1,d_2,d_3,d_4$: her ay için talep (demand). </p>
<p>Kisitlamalar</p>
<p>$0 \le x_i \le 40$, ki $i=1,2,3,4$: normal işçilikle üretilebilecek tekne
sayısı, çünkü üstte belirttik, o tür üretimin sınırı bu</p>
<p>$y_i \ge 0$: fazla mesai ile üretilebilecek tekne sayısı sınırsız. Tabii ki
negatif tekne üretilemez, o sebeple sıfırdan büyüklük var. </p>
<p>$h_i + x_i + y_i = d_i + h_{i+1}$: teknelerin muhafazası denklemi. Burada
diyoruz ki her ay başında depodaki tekneler artı normal ve fazla mesai
işçilik ile ürettiğim teknelerin toplamı, o aydaki talep ve sonraki aya
kalacak depodaki teknelerin toplamı ile aynı olmalı. </p>
<p>Ayrıca $h_1=10$ olduğunu biliyoruz.</p>
<p>Önceki noktayı tekrar vurgulamak gerekirse üstteki $h$ değişkenlerini belki
tanımlamam fuzuli, onları $h,d$'ler üzerinden de tanımlayabilirdim. Ama bu
şekilde yapmak çok daha açık. </p>
<p>[atlandi]</p>
<p>Bu problemin lineer program olduğunu görebiliyoruz, ama hiçbir ağ akışı
filan göstermedim. O zaman dersimizin başlığı niye ağ akışı? Çünkü bu
problemi bir ağ yapısı içinden akış olarak görmek te oldukca doğal. 
Ağdaki 1,2,3,4 düğümleri aylar olacak, ve tekneler o aylar içinden
"akıyorlar", eğer bir ay sonrasında depoya bir tekne koyuyorsak sanki o
tekne geleceğe doğru gönderiliyor, sonraki aya veriliyor, o sebeple aylar
arasındaki oklar $h_i$. </p>
<p><img alt="" src="func_90_nflow_01.png" /></p>
<p>Tabii tüm tekneler bir aydan ötekine akmıyor, müşterilerin (customers)
talebine göre o aydan onlara da belli sayıda tekne "akıyor", $d_i$ ile
gösterilenler. Her aya giren akış üretim, R ile gösterilen normal
işçilikle, OT ile gösterilen fazla mesai ile.  Bu resimle problemi bir ağ
akışı olarak göstermiş olduk.</p>
<p>Daha önce gördüğümüz muhafaza denklemi bu resimde daha bariz hale geldi,
çünkü bu resimle aslında şunu söylüyoruz, her ay düğümüne giren akışlar
çıkış akışlarına eşit olmalı. Bu hem kuvvetli bir ifade ama aynı anda
bariz. Düğümler içinde bir şey tutmamalı, oradan sadece akış var. </p>
<p>Bugün genel olarak göreceğimiz konu minimum bedel akış problemleri olacak,
ki üstteki problem bunun bir örneği. Pek çok optimizasyon problemi yönlü
bir ağ üzerindeki akış olarak görülebiliyor. </p>
<p>Alttaki gibi bir ağ düşünelim,</p>
<p><img alt="" src="func_90_nflow_02.png" /></p>
<p>8 tane düğümü var, bazı kenarları var. Bu ağdaki karar değişkenleri her
kenardaki akış. Dikkat, karar değişkeni düğümde değil, kenarda. Bulmak
istediğimiz bu akış çünkü, bilahere karar değişkenleri. Bu kenarların her
birinde ne kadar akış var? </p>
<p>Her kenardaki akışın bir bedeli olabilir, ayrıca her kenarın bir kapasite
sınırlaması olabilir (bedeli ne olursa olsun üzerine çıkılamayacak bir eşik
değeri). Bedel örneği olarakl mesela bir kenar 2 lira/birimlik olabilir
diğeri 10 lira/birim bedelinde olabilir. O zaman ilk kenardan 5 birim
göndermek istersem bunun bana bedeli 10 lira ikincisinden gondermek
istersem 50 lira olacak. Her kenarın akış bedeli, kapasitesi bizim
dışarıdan bir parametre ile tanımladığımız bir şey olacak tabii
ki. Kapasitenin illa sınırlanmış olması gerekmez, sınırsız da olabilir.</p>
<p>Her düğüm bir akış kaynağı (source) da olabilir, yani akışı kendi içinden
"doğuruyor" olabilir. Bazı düğümler akışı yutuyor olabilir, onlara akış
gelir ve yokolur, bu düğümlere alıcı (sink) diyebiliriz. O zaman önceki
gördüğümüz sadece aktarıcı düğümlere ek olarak bu iki tip düğümü de
kullanabiliriz. Üstteki resimde en soldaki iki düğüm kaynak gibi duruyor,
oradan sadece çıkan akış görüyoruz. En sağdaki ise alıcı, ona akış sadece
giriyor. </p>
<p>Optimizasyon probleminin sorduğu soru şu olacak, "en minimum bedelli akış
hangisi?". Pek çok türlü akış olabilir, bizim aradığımız bedeli en az
olan. Bugün göreceğimiz tüm problemler birer minimum bedelli akış problemi
olarak formülize edilebilir. İlk önce en başta gördüğümüz problemi ağ
yapısına tercüme edeceğiz, sonra diğer göreceğimiz problemlerin birer LP
olup olmadığına bakacağız. </p>
<p>Düğümleri numaralandıralım,</p>
<p><img alt="" src="func_90_nflow_03.png" /></p>
<p>Her akışı, karar değişkenini $x_{ij}$ olarak gösterebiliriz, ki
$(i,j) \in \varepsilon$, 1'den 3'e akış $x_{13}$ olacak. Akış bedeli
$c_{ij}$. Toplam bedel her akış çarpı o akışın bedeli toplanmış
hali. Kapasite sınırları $p_{ij} \le x_{ij} \le q_{ij}$ ile gösterilebilir,
her kenarın bir alt bir de üst sınırı olabilir ($p_{ij}$ çoğu problem için
sıfırdır). Muhafaza denklemi, her düğüm $k$ için [1, 26:22]</p>
<p>$$
\sum_{j \in N} x_{kj} - \sum_{i \in N} x_{ik} = b_k, \quad \forall k \in N
$$</p>
<p>Toplam bedel</p>
<p>$$
\sum_{(i,j) \in \varepsilon } c_{ij} x_{ij}
$$</p>
<p>Üstteki ifade üzerinden toplam bedeli minimize eden akışı bulabiliriz. </p>
<p>Bu bir lineer program değil mi? Bedel lineer, lineer eşitlik, eşitsizlik
sınırlamaları. Evet bu bir LP. </p>
<p>Formel ve öz bir şekilde yazmak gerekirse, </p>
<p>$$
\min_{x_{ij} \in \mathbb{R}} \sum_{(i,j) \in \varepsilon } c_{ij} x_{ij}
\quad \textrm{öyle ki}
$$
$$
\sum_{j \in N} x_{kj} - \sum_{i \in N} x_{ik} = b_k, \quad \forall k \in N
$$
$$
p_{ij} \le x_{ij} \le q_{ij}
$$</p>
<p>Şimdi muhafaza kısıtlamasına dönmek istiyorum, aslında bu formülü matris
formunda yazmanın çok güzel bir yolu var. </p>
<p><img alt="" src="func_90_nflow_04.png" /></p>
<p>Matrise $A$ sembolü verilir çoğunlukla ve ona oluş, geliş (incidence)
matrisi denir.  Örnek olarak sonuncu satıra bakalım, bu satır 8'inci düğüme
olanları gösteriyor, $-x_{68}-x_{78}$ hesabı var, eksi işareti düğüme giriş
göstergesi, ve sonuç $b_8$'e eşit. </p>
<p>$A$'da sadece 0, -1 ve +1 değerleri vardır ve eldeki düğüm kadar satırı
vardır, ve eldeki kenar kadar kolonu vardır. Dikkat geliş matrisi sadece ağ
yapısını kodlar, kenarlardan giden akış miktarı hala $x_{ij}$ değerlerinin
kendisinde. </p>
<p>Eğer gereken yerde vektörler de kullanırsak en öz haliyle model şöyle,</p>
<p>$$
\min_{x \in \mathbb{R}^{|\varepsilon|}} c^T x, \quad \textrm{oyle ki}
$$
$$
Ax = b
$$
$$
p \le x \le q
$$</p>
<p>Denge konusundan bahsedelim, minimum bedelli akış probleminin "dengeli"
olması durumu var. Üstteki örnekteki gibi bir problemi düşünürsek, bazı
düğümle kaynak, bazıları alıcı, tüm düğümlerdeki girenler çıkanlar sıfıra
toplanır, o zaman tüm kaynakların toplamının da tüm talebin toplamına eşit
olması beklenir. Çünkü ekstra kaynak varsa mesela tüm denklemleri tatmin
etmek mümkün olmaz. Bunu ispatlayabiliriz, geliş matrisinin bir özelliği
tüm kolonlarının toplamının sıfır olması, yani $1^T A = 0$. Ayrıca $Ax =
b$'nin de doğru olduğunu biliyoruz çünkü çözeceğimiz sistemin bir
kısıtlaması bu formül. O zaman alttaki de doğru olmalı, </p>
<p>$$
1^T A x = 1^T b = 0
$$</p>
<p>Eşitliğin sağındaki $1^T b$ tüm $b$ öğelerinin toplamı demek, yani</p>
<p>$$
\sum _{i \in N} b_i = 0
$$</p>
<p>olmalı. Demek ki tüm arz tüm talebe eşit olacak. O zaman size $b$'sı sıfıra
toplanmayan bir minimum bedel akış problemi verirsem bu problem olurlu
olmayacaktır. Toplam sıfır ise bu probleme "dengeli problem"
deniyor. Tabii dengeli bir modelin de illa olurlu olması şart değil, mesela
öyle kapasite sınırlamaları getirebilirsiniz ki olurluluk mümkün olmaz, ama
denge yoksa problem kesinlikle olurlu değildir.</p>
<p>Ama bazen dengesiz problemleri de ufak değişiklikler ile çözmek mümkün
oluyor, mesela bazı $=$'leri $\le$ yaparak, ki bunun karşılığı ağa bir
kukla (dummy) düğüm eklemek olabilir .. Ya da pay bırakma (slack)
değişkenleri ekleyip bazı eşitsizlikleri eşitlikge çevirerek..</p>
<p>Örnek Alanlar </p>
<p>Ne kadar çok problemin minimum akış problemi olabildiği şaşırtıcı
olabilir. </p>
<ul>
<li>nakliyat problemleri  (transportation)</li>
<li>görev verme / atama problemleri (assignment)</li>
<li>aktarmalı gemi nakliyatı (transshipment)</li>
<li>en kısa yol problemleri (shortest path)</li>
<li>maksimum akış problemleri (max-flow)</li>
</ul>
<p>Nakliyat</p>
<p>Hedef belli bir mali birkaç kaynak noktasından farklı varış noktalarına
ulaştırmak. </p>
<p>[devam edecek]</p>
<p>Kaynaklar</p>
<p>[1] Lessard, <em>Introduction to Optimization, CS/ECE/ISyE 524, Lecture 5</em>, 
    University of Wisconsin-Madison,
    <a href="https://laurentlessard.com/teaching/524-intro-to-optimization">https://laurentlessard.com/teaching/524-intro-to-optimization</a></p>