<h1>Altgradyanlar (Subgradients)</h1>
<!DOCTYPE html>
<html>
  <head>
    <title>Altgradyanlar (Subgradients)
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [["$","$"]]}
      });
    MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
      MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
        cancel: ["Extension","cancel"],
        bcancel: ["Extension","cancel"],
        xcancel: ["Extension","cancel"],
        cancelto: ["Extension","cancel"]
      });
    });
    </script>
<script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML-full">
</script>
</head>

<p>Altgradyanlar aslında bir algoritma değil, bir matematiksel kavram, ve hem
optimizasyon, hem analiz, hem de pratik bağlamda çok faydalı bir kavram.
Hatırlarsak dışbükey ve türevi alınabilir bir $f$ için</p>
<p>$$
f(y) \ge f(x) + \nabla f(x)^T (y-x)  \quad \forall x,y
$$</p>
<p>gerekli ve yeterli bir şart. Yani fonksiyonuma herhangi bir noktada
oluşturacağım lineer yaklaşıksallık, yani teğet eğri, fonksiyonum için bir
global eksik / az tahmin edici (ünderestimator) olacaktır, yani hep ondan
küçük kalacaktır. Bu mantıklı, görsel olaral hayal edersek kap şeklinde,
yani dışbükey olan bir fonksiyona nerede teğet çizgi çekersem çekeyim
fonksiyonun kendisi hep o çizginin üstünde kalır. Eğer fonksiyonum kap
olmasaydı, habire aşağı yukarı inip çıkıyor olsaydı bir noktada o çizginin
altına düşülebilirdi. Eğer $f$ türevi alınabilir ise dışbükey olmasının
şartı üstteki ifadenin doğru olması.</p>
<p>Altgradyan nedir? Altgradyan üstteki gradyanin yerini alabilecek herhangi
bir $g$ vektörüdür, yerine alabilecek derken üstteki ifade her $y$ için
hala doğru olacak şekilde. </p>
<p>$$
f(y) \ge f(x) + g^T (y-x) \quad \forall y
$$</p>
<p>Dışbükey fonksiyonlar için $g$ her zaman mevcuttur (dışbükey olmayan
fonksiyonlar için $g$'nin mevcudiyeti şart değildir). Mantıki olarak
düşünürsek bir $f$ için ona eksik tahmin edici olacak bir çizgiyi her zaman
çizebiliriz. Bir noktayı seç, bir $f$ noktasından geçen bir çizgi çek.</p>
<p>Eğer $x$ noktasında $f$'in türevi alınabilir ise, tek bir altgradyan
vardır, o da türevin kendisidir, $g = \nabla f(x)$. </p>
<p>Pürüzsüz olan dışbükey olmayan ve altgradyani olmayan bir fonksiyon örneği
görelim, </p>
<p><img alt="" src="func_42_subgrad_01.png" /></p>
<p>Bu fonksiyonun hiçbir yerde altgradyani yok. Eğri üzerinde bir nokta
arıyorum öyle ki oradan geçen bir çizgi tüm fonksiyonu üstte
bıraksın.. böyle bir çizgi çizilemez. Altgradyan yok. Bazılarımız itiraz
edebilir, "üstteki bir içbükey fonksiyon, dışbükeyin ters çevrilmiş
hali". O zaman $x^3$ diyelim, pürüzsüz, ve altgradyanı yok.</p>
<p>Altgradyanı olan fonksiyonlar görelim, mesela mutlak değer fonksiyonu $f(x) = |x|$.</p>
<p><img alt="" src="func_42_subgrad_02.png" /></p>
<p>Altgradyanlar için farklı şartları görelim.</p>
<p>$x&gt;0$ için tek bir altgradyan var, o da $g = 1$, yani fonksiyonun eğiminin
ta kendisi, eğim=1. Aynı şekilde $x&lt;0$ için, o zaman $g=-1$. Bu sonuç
"eğer $f$'in türevi alınabilir ise $g=\nabla f$" açıklaması ile
uyuyor. $x=0$ noktası için birçok seçenek var, herhangi bir $[-1,1]$ öğesi
için, yani -1 ve +1 arasındaki herhangi bir sayı olabilir, çizgili noktalar
seçeneklerden ikisi.</p>
<p>Boyut atlayalım, $f(x) = ||x||_2$ fonksiyonunu görelim, $x$'in L2
norm'u. Iki boyutta,</p>
<p><img alt="" src="func_42_subgrad_03.png" /></p>
<p>Eğer $x \ne 0$ ise bu fonksiyonun türevi alınabilir (yoksa alınamaz, bir
yaygın görüşe göre $x=0$'da problem yok, ama var) ve altgradyanı onun
mevcut gradyanı, $x / ||x||_2$. $x=0$ noktasında altgradyan $g$
${ z: ||z||_2 &lt; 1}$ kümesinin herhangi bir öğesi.</p>
<p>Şimdi $f(x) = ||x||_1$'e bakalım,</p>
<p><img alt="" src="func_42_subgrad_04.png" /></p>
<p>Bu fonksiyonun $x=0$'da türevi alınamaz, aynen tek boyutlu (mutlak değer
fonksiyonu) versiyonunda olduğu gibi. Ayrıca bu fonksiyonun herhangi bir
eksende sıfır değer olduğu zamanda da türevi alınamaz. Altgradyan için öğe öğe
yaklaşmak lazım, eğer bir öğe $x_i \ne 0$ ise $g_i = \mathrm{sign}(x_i)$, eğer
$x_i = 0$ ise $g_i \in [-1,+1]$.</p>
<p>En son örnek iki dışbükey fonksiyonun maksimumu olanı, yani
$f(x) = \max {f_1(x),f_2(x) }$ ki $f_1,f_2$ dışbükey ve türevi alınabilir
olmak üzere, ve $f(x)$ bu iki fonksiyonun her $x$ noktasında $f_1(x)$ ve
$f_2(x)$'den hangisi büyükse o. Bu tür bir maks fonksiyonunun sonucunun
dışbükey olduğunu önceki derslerden biliyoruz. </p>
<p><img alt="" src="func_42_subgrad_05.png" /></p>
<p>Altgradyan yine farklı şartlara göre değişik oluyor. Eğer $f_1(x) &gt; f_2(x)$
o zaman altgradyan özgün, $g = \nabla f_1(x)$. Eğer $f_2(x) &gt; f_1(x)$ ise
altgradyan özgün, $g = \nabla f_2(x)$. </p>
<p>Kabaca çizersek birbirlerini kesen $f_1$ ve $f_2$ düşünelim, </p>
<p><img alt="" src="func_42_subgrad_06.png" /></p>
<p>onların maks halleri yeşil ile [çok kabaca benim eklediğim] çizgi, yani
kesişmenin solunda $f_2$ sağında $f_1$. Tabii ki sol tarafta $f_2$ aktif o
zaman onun gradyanı geçerli, sağ tarafta $f_1$. Kesişme noktası, $f_1=f_2$
ilginç, $g = \alpha \nabla f_1(x) + (1-\alpha) f_2(x)$, yani $f_1,f_2$'nin
herhangi bir dışbükey kombinasyonu, ki iki üstteki resimde görülen iki
kesikli çizgiler bazı örnekler. </p>
<p>Altdiferansiyel (Subdifferential)</p>
<p>Dişbükey $f$'in tüm altgradyanlarına altdiferansiyel denir. Çoğunlukla
kısmi türev için kullanılan aynı sembolle gösterilir, $\partial$ ile.</p>
<p>$$
\partial f(x) = { 
g \in \mathbb{R}^n: \quad g, f\textrm{'in altgradyanıdır}
}
$$</p>
<p>Yani $x$ noktasındaki tüm mümkün altgradyanların kümesi altdiferansiyel
oluyor. </p>
<p>[atlandi]</p>
<p>Altgradyanların kendine has bir Calculus'u var, aynen gradyanları,
vs. içere Çok Değişkenli Calculus'ta olduğu gibi. </p>
<p>Ölçekleme: $\partial (af) = a \cdot \partial f$, $a$ sabit ise ve $a &gt; 0$
olacak şekilde</p>
<p>Toplama: $\partial (f_1 + f_2) = \partial f_1 + \partial f_2$</p>
<p>Doğrusal Bileşim: Eğer $g(x) = f(Ax + b)$ ise o zaman
$\partial g(x) = A^T \partial f(Ax + b)$. Bu altgradyanlar için bir tür
Zincirleme Kanunu gibi. Hatta eğer $f$ türevi alınabilir ise, bu ifade tamı
tamına Zincirleme Kanunu olurdu. </p>
<p>Noktasal Sonlu Maksimum: Eger $f(x) = \max_{i=1,..,m} f_i(x)$ ise, o zaman </p>
<p>$$
\partial f(x) = conv \left( 
\bigcup_{i: f_i(x)=f(x)} \partial f_i(x)
\right)
$$</p>
<p>Biraz karmaşık duruyor ama daha önce iki fonksiyon maksimumu üzerinden
gördüğümüz kavrama benziyor. Her noktada maks olan $f_i$'leri alıyoruz, ve
bu fonksiyonların altgradyanlarını hesaplıyoruz. Ama bu altgradyanların
birleşimi her zaman bir dışbükey küme oluşturmayabilir, ve
altdiferansiyelin bir dışbükey küme olması gerekir, o zaman için elimizde
olan altgradyanların $conv$ ile dışbükey zarfına (convex hull)
bakarız. Yani sadece birleşim $\cup$ ile elde ettiğim kümeyi bir işlemden
daha geçirerek onun dışbükey küme halini alıyorum.</p>
<p>[atlandi, norm]</p>
<p>Niye Altgradyanlar?</p>
<p>1) Optimizasyon: Önemli bir sebep. Bir dışbükey fonksiyonun altgradyanını
hesaplamak her zaman mümkündür, o zaman her dışbükey fonksiyonu minimize
edebilirim. Bazı durumlarda bu yavaş olabilir ama en azından minimizasyon
mümkün olur.</p>
<p>2) Dişbükey Analizi: Her $f$ için, dışbükey olsun olmasın, </p>
<p>$$
f(x^*) = \min_x f(x) \iff 0 \in \partial f(x^*)
$$</p>
<p>Yani $x^*$ bir minimize edicidir sadece ve sadece 0 $f$'in $x^*$ noktasında
bir altgradyanı ise. Bu özelliğe çoğunlukla "altgradyan optimalliği" adı
veriliyor. İspatı basit. Eğer $g$ vektörü $x^*$ noktasındaki altgradyan
ise o zaman alttaki ifade her $y$ için doğrudur,</p>
<p>$$
f(y) \ge f(x^*) + 0^T (y-x^*) = f(x^*)
$$</p>
<p>$$
f(y) \ge f(x^*) \quad \forall y
$$</p>
<p>Üstteki ifade $x^*$ bir minimize edicidir diyor, o zaman sıfır bir
altgradyandir. </p>
<p>Bazen üstteki ifadenin dışbükey olmayan fonksiyonlar için bile geçerli
olduğunu unutanlar oluyor. Bu her $f$ için doğru diyorum bazen bana
şaşırmış şekilde bakıyorlar. Söylenen biraz sürpriz edici, evet. İkizlik ve
KKT şartları hakkında konuşurken benzer şaşırtıcı ifadeler olacak. </p>
<p>Tabii eklemek gerekir bazen dışbükey olmayan fonksiyonlar için altgradyan
hesaplanamaz, ya da mevcut değillerdir. Her problemi çözmek için bir yemek
tarifi değil bu. Mesela başta gördüğümüz içbükey fonksiyon,</p>
<p><img alt="" src="func_42_subgrad_01.png" /></p>
<p>Altgradyanı yok (ama tabii minimize edicisi de yok). </p>
<p>[Ders 7'den devam ediyoruz [2]]</p>
<p>Altgradyanlar bir dışbükey fonksiyon için her zaman mevcuttur, bazı aşırı
durumlar haricinde, mesela gösterge fonksiyonu $I$'nin uç noktalarında
mevcut değildir. </p>
<p>Şimdi altgradyan yönteminin gücüne bir örnek görelim. Derslerimizin başında
1. derece optimallik şartını görmüştük, </p>
<p>$$
\min_x f(x) \quad \textrm{öyle ki} x \in C
$$</p>
<p>problemini çözmek istiyoruz, diyelim $f$ dışbükey ve türevi alınabilir. Bu
problem için $x$'in çözüm olmasının şartı </p>
<p>$$
\nabla f(x)^T (y-x) \ge 0 \quad \forall y \in C
$$</p>
<p>eşitsizliğinin doğru olmasıdır. Yani 1. derece minimallik gradyan sıfırı
verir, o zaman herhangi bir $\nabla f(x)^T(y-x)$ yönünde adım atmak bizi her
zaman bu minimallikten uzaklaştırmalıdır. Bu durum her olurlu $y \in C$
için doğru ise minimal yerdeyiz demektir.</p>
<p>Üsttekini altgradyan perspektifinden ispatlayabiliriz. Önce problemimizi
sınırsız bir formatta tekrar tanımlayacağız.  Sınırlamayı bir gösterge $I_C$
haline getirerek bunu yapabiliriz,</p>
<p>$$
\min_x f(x) + I_C(x)
$$</p>
<p>ki $I_C(x) = 0$ eğer $x$, $C$ kümesi içindeyse, dışındaysa sonsuzluk. Şimdi
üstteki fonksiyona altgradyan optimalliği uygulayalım, eğer üstteki
fonksiyonu minimize eden bir nokta varsa elimde, bunun tercümesi sıfırın o
noktada fonksiyonun altgradyanı olması. Fonksiyonun altgradyanini
hesaplayalım, kurallarımıza göre iki dışbükey fonksiyon toplamının
altgradyani o fonksiyonların ayrı ayrı altgradyanlarının toplamı. $f$
dışbükey, $I_C$ dışbükey (çünkü $C$ kümesi dışbükey küme). $f$ pürüzsüz, o
zaman $x$'te onun altgradyan kümesi sadece o noktadaki gradyan. $I_C$'nin
altgradyanı normal koni $N_C$. O zaman </p>
<p>$$
0 \in \partial ( f(x) + I_C(x) ) = \nabla f(x) + N_C(x) 
$$</p>
<p>olmalı, ya da</p>
<p>$$
- \nabla f(x) \in N_C(x) 
$$</p>
<p>olmalı. Şimdi normal koniyi hatırlayalım, tanımı</p>
<p>$$
N_C(x) = { g \in \mathbb{R}^n: g^T x \ge g^T y \quad \forall y \in C
$$</p>
<p>buna göre iki üstteki $N_C$, $g=-\nabla f$ üzerinden</p>
<p>$$
-\nabla f(x)^T x \ge -\nabla f(x)^T y \quad \forall y \in C
$$</p>
<p>olarak açılabilir. Ya da</p>
<p>$$
\nabla f(x)^T(y-x) \ge 0 \quad \forall y \in C
$$</p>
<p>$-\nabla f(x)$ üstteki tanımın bir öğesidir.</p>
<p>[devam edecek]</p>
<p>Kaynaklar</p>
<p>[1] Tibshirani, <em>Convex Optimization, Lecture Video 6</em>, 
<a href="https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg">https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg</a>   </p>
<p>[2] Tibshirani, <em>Convex Optimization, Lecture Video 7</em>, 
<a href="https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg">https://www.youtube.com/channel/UCIvaLZcfz3ikJ1cD-zMpIXg</a>   </p>